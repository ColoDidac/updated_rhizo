{"ast":null,"code":"import { ActivatedRoute, Router } from '@angular/router';\nimport { BreadcrumbService } from '../breadcrumb/breadcrumb.service';\nimport { Description } from '../description/description';\nimport { DatasetService } from '../dataset/dataset.service';\nimport { BehaviorSubject } from 'rxjs';\nimport { TranslateService } from '@ngx-translate/core';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../breadcrumb/breadcrumb.service\";\nimport * as i3 from \"@ngx-translate/core\";\nimport * as i4 from \"../dataset/dataset.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"../facet/type-facet/type-facet.component\";\nimport * as i8 from \"../description/description.component\";\n\nfunction SearchComponent_a_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"a\", 22);\n    i0.ɵɵlistener(\"click\", function SearchComponent_a_8_Template_a_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return ctx_r10.showFacets = true;\n    });\n    i0.ɵɵelement(1, \"span\", 23);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction SearchComponent_a_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"a\", 22);\n    i0.ɵɵlistener(\"click\", function SearchComponent_a_9_Template_a_click_0_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return ctx_r12.showFacets = false;\n    });\n    i0.ɵɵelement(1, \"span\", 24);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction SearchComponent_span_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 3);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r3.totalInstances);\n  }\n}\n\nfunction SearchComponent_span_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 25);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 1, \"search.no-facets\"));\n  }\n}\n\nfunction SearchComponent_span_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 3);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 1, \"search.loading\"));\n  }\n}\n\nfunction SearchComponent_div_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 26);\n    i0.ɵɵelement(1, \"div\", 27);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction SearchComponent_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"app-description\", 28);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const resource_r14 = ctx.$implicit;\n    const ctx_r7 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"datasetId\", ctx_r7.datasetId)(\"description\", resource_r14)(\"details\", false)(\"anonDescriptions\", ctx_r7.anonResources)(\"labels\", ctx_r7.labels);\n  }\n}\n\nfunction SearchComponent_p_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 29);\n    i0.ɵɵi18n(1, 30);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵpipe(4, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵi18nExp(i0.ɵɵpipeBind1(2, 6, \"search.showing\"))(ctx_r8.resources == null ? null : ctx_r8.resources.length)(i0.ɵɵpipeBind1(3, 8, \"search.outof\"))(ctx_r8.totalInstances)(ctx_r8.totalInstances)(i0.ɵɵpipeBind1(4, 10, \"search.matches\"));\n    i0.ɵɵi18nApply(1);\n  }\n}\n\nfunction SearchComponent_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 31);\n    i0.ɵɵelementStart(1, \"small\", 32);\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(3, 1, \"search.explore\"));\n  }\n}\n\nconst _c4 = function (a0, a1) {\n  return {\n    \"d-none d-sm-none d-md-block\": a0,\n    \"d-block\": a1\n  };\n};\n\nexport let SearchComponent = /*#__PURE__*/(() => {\n  class SearchComponent {\n    constructor(router, route, breadcrumbService, translate, datasetService) {\n      this.router = router;\n      this.route = route;\n      this.breadcrumbService = breadcrumbService;\n      this.translate = translate;\n      this.datasetService = datasetService;\n      this.text = new BehaviorSubject('');\n      this.totalInstances = 0;\n      this.page = 1;\n      this.pageSize = 20;\n      this.resources = [];\n      this.anonResources = new Map();\n      this.labels = new Map();\n    }\n\n    ngOnInit() {\n      this.datasetId = this.route.snapshot.paramMap.get('did') || 'default';\n      this.route.queryParams.subscribe(params => this.text.next(params['text']));\n      this.text.subscribe(text => this.search(text));\n    }\n\n    search(text) {\n      this.resources = undefined;\n      this.totalInstances = undefined;\n      this.page = 1;\n      window.scrollTo(0, 0);\n      this.datasetService.getSearchInstancesCount(this.datasetId, text).subscribe({\n        next: count => this.totalInstances = count,\n        error: () => {\n          this.totalInstances = 0;\n          this.resources = [];\n        }\n      });\n      this.loadInstances(this.datasetId, text, this.page);\n    }\n\n    loadInstances(datasetId, text, page) {\n      this.datasetService.searchInstances(datasetId, text, page, this.pageSize).subscribe({\n        next: instances => {\n          this.labels = new Map([...Description.getLabels(instances)]);\n\n          if (instances['@graph']) {\n            this.anonResources = Description.getAnonResources(instances, this.labels, this.translate.currentLang);\n            this.resources = Description.getTypedResources(instances, this.labels, this.translate.currentLang);\n          } else if (instances['@type']) {\n            this.resources = [new Description(instances, instances['@context'], this.labels, this.translate.currentLang)];\n          } else {\n            this.resources = [];\n          }\n\n          this.sortResource();\n        },\n        error: error => console.log(error)\n      });\n    }\n\n    goToPage(page) {\n      window.scrollTo(0, 0);\n      this.resources = undefined;\n      this.loadInstances(this.datasetId, this.text.getValue(), page);\n    }\n\n    sortResource() {\n      this.resources.sort((a, b) => {\n        if (a.label && b.label) {\n          return a.label.toLowerCase().localeCompare(b.label.toLowerCase());\n        } else if (!a.label && b.label) {\n          return -1;\n        } else if (a.label && !b.label) {\n          return 1;\n        } else {\n          return a['@id'].localeCompare(b['@id']);\n        }\n      });\n    }\n\n    searchContains(text) {\n      this.router.navigate([], {\n        queryParams: {\n          'text': text\n        }\n      });\n    }\n\n    currentText() {\n      return this.text.getValue();\n    }\n\n    ngOnDestroy() {\n      this.breadcrumbService.clearFilter();\n    }\n\n  }\n\n  SearchComponent.ɵfac = function SearchComponent_Factory(t) {\n    return new (t || SearchComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.BreadcrumbService), i0.ɵɵdirectiveInject(i3.TranslateService), i0.ɵɵdirectiveInject(i4.DatasetService));\n  };\n\n  SearchComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: SearchComponent,\n    selectors: [[\"app-search\"]],\n    decls: 30,\n    vars: 22,\n    consts: function () {\n      let i18n_1;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_6847031643594997524$$SRC_APP_SEARCH_SEARCH_COMPONENT_TS__2 = goog.getMsg(\"{VAR_PLURAL, plural, =1 {1 match} other {{INTERPOLATION} {INTERPOLATION_1}}}\");\n        i18n_1 = MSG_EXTERNAL_6847031643594997524$$SRC_APP_SEARCH_SEARCH_COMPONENT_TS__2;\n      } else {\n        i18n_1 = $localize`:␟8be452e7fb83d6ffc37ccf0c3e981e0520d6f26e␟6847031643594997524:{VAR_PLURAL, plural, =1 {1 match} other {{INTERPOLATION} {INTERPOLATION_1}}}`;\n      }\n\n      i18n_1 = i0.ɵɵi18nPostprocess(i18n_1, {\n        \"VAR_PLURAL\": \"\\uFFFD3\\uFFFD\",\n        \"INTERPOLATION\": \"\\uFFFD4\\uFFFD\",\n        \"INTERPOLATION_1\": \"\\uFFFD5\\uFFFD\"\n      });\n      let i18n_0;\n\n      if (typeof ngI18nClosureMode !== \"undefined\" && ngI18nClosureMode) {\n        const MSG_EXTERNAL_8061740770801009903$$SRC_APP_SEARCH_SEARCH_COMPONENT_TS__3 = goog.getMsg(\" {$interpolation} {$interpolation_1} {$interpolation_2} {$icu}\", {\n          \"interpolation\": \"\\uFFFD0\\uFFFD\",\n          \"interpolation_1\": \"\\uFFFD1\\uFFFD\",\n          \"interpolation_2\": \"\\uFFFD2\\uFFFD\",\n          \"icu\": i18n_1\n        });\n        i18n_0 = MSG_EXTERNAL_8061740770801009903$$SRC_APP_SEARCH_SEARCH_COMPONENT_TS__3;\n      } else {\n        i18n_0 = $localize`:␟ff30dafeb60a79bae85b6ff298a44e3eb129eee6␟8061740770801009903: ${\"\\uFFFD0\\uFFFD\"}:INTERPOLATION: ${\"\\uFFFD1\\uFFFD\"}:INTERPOLATION_1: ${\"\\uFFFD2\\uFFFD\"}:INTERPOLATION_2: ${i18n_1}:ICU:`;\n      }\n\n      return [[\"id\", \"faceted\", 1, \"row\"], [\"id\", \"facets\", 1, \"col-md-4\", \"m-0\"], [1, \"p-1\"], [1, \"badge\", \"badge-warning\", \"badge-pill\"], [1, \"d-block\", \"d-md-none\", \"d-lg-none\", \"d-xl-none\", \"float-right\"], [3, \"click\", 4, \"ngIf\"], [3, \"ngClass\"], [1, \"card\", \"facet\", \"p-2\", \"mb-2\"], [1, \"input-group\"], [\"id\", \"search\", \"name\", \"search\", \"type\", \"text\", \"placeholder\", \"Search all...\", 1, \"pl-3\", \"form-control\", \"form-control-sm\", 3, \"ngModel\", \"keyup.enter\"], [\"inputText\", \"\"], [1, \"input-group-append\"], [\"type\", \"button\", 1, \"btn\", \"btn-sm\", \"btn-secondary\", 3, \"click\"], [1, \"fa\", \"fa-search\"], [3, \"datasetId\", \"text\"], [\"id\", \"instances\", 1, \"col-md-8\", \"m-0\"], [\"class\", \"badge badge-warning badge-pill\", 4, \"ngIf\"], [\"class\", \"badge badge-danger badge-pill\", 4, \"ngIf\"], [\"id\", \"loading\", \"class\", \"text-center mb-3\", 4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"text-center mb-0\", 4, \"ngIf\"], [\"class\", \"text-center mt-0 mb-3\", 4, \"ngIf\"], [3, \"click\"], [1, \"fa\", \"fa-plus-circle\", \"ml-1\"], [1, \"fa\", \"fa-minus-circle\", \"ml-1\"], [1, \"badge\", \"badge-danger\", \"badge-pill\"], [\"id\", \"loading\", 1, \"text-center\", \"mb-3\"], [\"id\", \"spinner\"], [3, \"datasetId\", \"description\", \"details\", \"anonDescriptions\", \"labels\"], [1, \"text-center\", \"mb-0\"], i18n_0, [1, \"text-center\", \"mt-0\", \"mb-3\"], [1, \"alert-warning\"]];\n    },\n    template: function SearchComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r15 = i0.ɵɵgetCurrentView();\n\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"h5\", 2);\n        i0.ɵɵtext(3);\n        i0.ɵɵpipe(4, \"translate\");\n        i0.ɵɵelementStart(5, \"span\", 3);\n        i0.ɵɵtext(6, \"1\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"span\", 4);\n        i0.ɵɵtemplate(8, SearchComponent_a_8_Template, 2, 0, \"a\", 5);\n        i0.ɵɵtemplate(9, SearchComponent_a_9_Template, 2, 0, \"a\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"div\", 6);\n        i0.ɵɵelementStart(11, \"div\", 7);\n        i0.ɵɵelementStart(12, \"div\", 8);\n        i0.ɵɵelementStart(13, \"input\", 9, 10);\n        i0.ɵɵlistener(\"keyup.enter\", function SearchComponent_Template_input_keyup_enter_13_listener() {\n          i0.ɵɵrestoreView(_r15);\n\n          const _r2 = i0.ɵɵreference(14);\n\n          return ctx.searchContains(_r2.value);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"div\", 11);\n        i0.ɵɵelementStart(16, \"button\", 12);\n        i0.ɵɵlistener(\"click\", function SearchComponent_Template_button_click_16_listener() {\n          i0.ɵɵrestoreView(_r15);\n\n          const _r2 = i0.ɵɵreference(14);\n\n          return ctx.searchContains(_r2.value);\n        });\n        i0.ɵɵelement(17, \"span\", 13);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(18, \"app-type-facet\", 14);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(19, \"div\", 15);\n        i0.ɵɵelementStart(20, \"h5\", 2);\n        i0.ɵɵtext(21);\n        i0.ɵɵpipe(22, \"translate\");\n        i0.ɵɵtemplate(23, SearchComponent_span_23_Template, 2, 1, \"span\", 16);\n        i0.ɵɵtemplate(24, SearchComponent_span_24_Template, 3, 3, \"span\", 17);\n        i0.ɵɵtemplate(25, SearchComponent_span_25_Template, 3, 3, \"span\", 16);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(26, SearchComponent_div_26_Template, 2, 0, \"div\", 18);\n        i0.ɵɵtemplate(27, SearchComponent_div_27_Template, 2, 5, \"div\", 19);\n        i0.ɵɵtemplate(28, SearchComponent_p_28_Template, 5, 12, \"p\", 20);\n        i0.ɵɵtemplate(29, SearchComponent_div_29_Template, 4, 3, \"div\", 21);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind1(4, 15, \"search.facets\"), \" \");\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngIf\", !ctx.showFacets);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.showFacets);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(19, _c4, !ctx.showFacets, ctx.showFacets));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngModel\", ctx.currentText());\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"datasetId\", ctx.datasetId)(\"text\", ctx.text);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind1(22, 17, \"search.Instances\"), \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.totalInstances > 0);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.totalInstances === 0);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.totalInstances === undefined);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.resources === undefined && ctx.totalInstances !== 0);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.resources);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.totalInstances && ctx.resources);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.totalInstances > (ctx.resources == null ? null : ctx.resources.length) && ctx.resources);\n      }\n    },\n    directives: [i5.NgIf, i5.NgClass, i6.DefaultValueAccessor, i6.NgControlStatus, i6.NgModel, i7.TypeFacetComponent, i5.NgForOf, i8.DescriptionComponent],\n    pipes: [i3.TranslatePipe],\n    styles: [\"\"]\n  });\n  return SearchComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}