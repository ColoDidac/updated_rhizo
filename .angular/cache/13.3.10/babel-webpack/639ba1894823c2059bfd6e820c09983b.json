{"ast":null,"code":"import { DOCUMENT } from '@angular/common';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { DatasetService } from '../dataset/dataset.service';\nimport { Description } from '../description/description';\nimport { UriUtils } from '../shared/uriutils';\nimport { Resource } from './resource';\nimport { IncomingFacet } from '../facet/incomingFacet';\nimport { TranslateService } from '@ngx-translate/core';\nimport { FacetDomain } from '../facet/facetDomain';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../dataset/dataset.service\";\nimport * as i3 from \"@ngx-translate/core\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"../description/description.component\";\nimport * as i6 from \"../facet/detail-incoming-facet/detail-incoming-facet.component\";\n\nfunction ResourceComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 8);\n    i0.ɵɵelementStart(1, \"h1\", 9);\n    i0.ɵɵtext(2, \"Loading...\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nconst _c0 = function (a0, a1, a2, a3) {\n  return {\n    \"col-md-3 m-0\": a0,\n    \"col-md-4 m-0\": a1,\n    \"col-md-9 m-0\": a2,\n    \"col-12 m-0\": a3\n  };\n};\n\nfunction ResourceComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵelement(1, \"app-description\", 11);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction4(6, _c0, (ctx_r1.resource.anonBody || ctx_r1.content) && ctx_r1.incomings && ctx_r1.incomings.length, (ctx_r1.resource.anonBody || ctx_r1.content) && ctx_r1.incomings && !ctx_r1.incomings.length, !ctx_r1.resource.anonBody && !ctx_r1.content && ctx_r1.incomings && ctx_r1.incomings.length, !ctx_r1.resource.anonBody && !ctx_r1.content && ctx_r1.incomings && !ctx_r1.incomings.length));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"datasetId\", ctx_r1.datasetId)(\"description\", ctx_r1.resource)(\"details\", true)(\"anonDescriptions\", ctx_r1.anonResources)(\"resource\", \"../resource\");\n  }\n}\n\nfunction ResourceComponent_div_3_a_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"a\", 18);\n    i0.ɵɵlistener(\"click\", function ResourceComponent_div_3_a_7_Template_a_click_0_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return ctx_r7.showFacets = true;\n    });\n    i0.ɵɵelement(1, \"span\", 19);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ResourceComponent_div_3_a_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"a\", 18);\n    i0.ɵɵlistener(\"click\", function ResourceComponent_div_3_a_8_Template_a_click_0_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext(2);\n      return ctx_r9.showFacets = false;\n    });\n    i0.ɵɵelement(1, \"span\", 20);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ResourceComponent_div_3_app_detail_incoming_facet_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-detail-incoming-facet\", 21);\n  }\n\n  if (rf & 2) {\n    const incoming_r11 = ctx.$implicit;\n    const ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"dataset\", ctx_r6.dataset)(\"facet\", incoming_r11)(\"resource\", ctx_r6.resourceUri);\n  }\n}\n\nconst _c1 = function (a0, a1) {\n  return {\n    \"d-none d-sm-none d-md-block\": a0,\n    \"d-block\": a1\n  };\n};\n\nfunction ResourceComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12);\n    i0.ɵɵelementStart(1, \"h5\", 13);\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementStart(4, \"span\", 9);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"span\", 14);\n    i0.ɵɵtemplate(7, ResourceComponent_div_3_a_7_Template, 2, 0, \"a\", 15);\n    i0.ɵɵtemplate(8, ResourceComponent_div_3_a_8_Template, 2, 0, \"a\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 16);\n    i0.ɵɵtemplate(10, ResourceComponent_div_3_app_detail_incoming_facet_10_Template, 1, 3, \"app-detail-incoming-facet\", 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind1(3, 6, \"search.facets\"), \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r2.incomings.length);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r2.showFacets);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.showFacets);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(8, _c1, !ctx_r2.showFacets, ctx_r2.showFacets));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.incomings);\n  }\n}\n\nfunction ResourceComponent_div_4_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 24);\n  }\n\n  if (rf & 2) {\n    const ctx_r12 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"innerHTML\", ctx_r12.resource.anonBody.values[0].value, i0.ɵɵsanitizeHtml);\n  }\n}\n\nfunction ResourceComponent_div_4_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 24);\n  }\n\n  if (rf & 2) {\n    const ctx_r13 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"innerHTML\", ctx_r13.content, i0.ɵɵsanitizeHtml);\n  }\n}\n\nconst _c2 = function (a0, a1) {\n  return {\n    \"col-md-6 order-md-6 m-0\": a0,\n    \"col-md-8 m-0\": a1\n  };\n};\n\nfunction ResourceComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 22);\n    i0.ɵɵtemplate(1, ResourceComponent_div_4_div_1_Template, 1, 1, \"div\", 23);\n    i0.ɵɵtemplate(2, ResourceComponent_div_4_div_2_Template, 1, 1, \"div\", 23);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(3, _c2, ctx_r3.incomings.length, !ctx_r3.incomings.length));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.resource.anonBody);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.content);\n  }\n}\n\nconst _c3 = function (a0) {\n  return {\n    uri: a0\n  };\n};\n\nconst _c4 = function (a0) {\n  return {\n    \"resource\": a0\n  };\n};\n\nexport let ResourceComponent = /*#__PURE__*/(() => {\n  class ResourceComponent {\n    constructor(router, route, datasetService, translate, document) {\n      this.router = router;\n      this.route = route;\n      this.datasetService = datasetService;\n      this.translate = translate;\n      this.document = document;\n      this.resource = new Resource();\n      this.anonResources = new Map();\n      this.labels = new Map();\n      this.remoteAnonResources = new Map();\n      this.loading = true;\n\n      this.router.routeReuseStrategy.shouldReuseRoute = () => false;\n\n      this.resource = new Resource({}, {}, new Map(), new Map(), this.translate.currentLang);\n    }\n\n    ngOnInit() {\n      this.datasetId = this.route.snapshot.paramMap.get('did') || 'default';\n      this.resourceUri = this.route.snapshot.queryParamMap.get('uri') || this.document.location.href;\n      this.datasetService.get(this.datasetId).subscribe(dataset => this.dataset = dataset);\n      this.datasetService.describeDatasetResource(this.datasetId, this.resourceUri).subscribe({\n        next: response => {\n          if (response['@graph']) {\n            this.labels = Description.getLabels(response);\n            this.anonResources = Description.getAnonResources(response, this.labels, this.translate.currentLang);\n            const resources = response['@graph'].filter(instance => UriUtils.expandUri(instance['@id'], response['@context']) === this.resourceUri).map(instance => new Resource(instance, response['@context'], this.labels, this.anonResources, this.translate.currentLang));\n            this.resource = resources.length ? resources[0] : new Resource({}, {}, new Map(), new Map(), this.translate.currentLang);\n            this.browseContent(response['@context']);\n          } else if (response['@id'] && response['@context'] && UriUtils.expandUri(response['@id'], response['@context']) === this.resourceUri) {\n            this.resource = new Resource(response, response['@context'], new Map(), new Map(), this.translate.currentLang);\n            this.browseContent(response['@context']);\n          }\n\n          this.setPageJsonLd(this.resource);\n          this.browseRemoteData(this.datasetId, this.resourceUri);\n        },\n        error: () => {\n          this.onNoData();\n        }\n      });\n      this.datasetService.resourceIncomingFacets(this.datasetId, this.resourceUri).subscribe({\n        next: incomings => {\n          this.incomings = incomings.map(incoming => new IncomingFacet(incoming)).sort((a, b) => a.getLabel(this.translate.currentLang).localeCompare(b.getLabel(this.translate.currentLang)));\n          this.incomings.forEach(incoming => incoming.domains = incoming.domains.map(domain => new FacetDomain(domain)).sort((a, b) => a.getLabel(this.translate.currentLang).localeCompare(b.getLabel(this.translate.currentLang))));\n        },\n        error: () => this.incomings = []\n      });\n    }\n\n    browseContent(context = {}) {\n      if (!this.resource.anonBody && this.resource.topicOf.length > 0) {\n        this.browseRemoteContent(this.datasetId, UriUtils.expandUri(this.resource.topicOf[0].asString(), context));\n      } else {\n        this.loading = false;\n      }\n    }\n\n    browseRemoteContent(datasetId, url) {\n      if (url && UriUtils.isUrl(url)) {\n        this.datasetService.browseUriContent(datasetId, url).subscribe(content => {\n          this.content = content;\n          this.loading = false;\n        });\n      } else {\n        this.loading = false;\n      }\n    }\n\n    browseRemoteData(datasetId, uri) {\n      if (!UriUtils.isUrl(uri)) {\n        this.loading = false;\n        return;\n      }\n\n      this.datasetService.browseUriData(datasetId, uri).subscribe({\n        next: remote => {\n          let remoteResource;\n\n          if (remote['@graph']) {\n            const labels = Description.getLabels(remote);\n            const anonResources = Description.getAnonResources(remote, this.labels);\n            remoteResource = remote['@graph'].filter(instance => UriUtils.expandUri(instance['@id'], remote['@context']) === this.resourceUri).map(instance => new Resource(instance, remote['@context'], labels, anonResources, this.translate.currentLang))[0];\n          } else {\n            remoteResource = new Resource(remote, remote['@context'], new Map(), new Map(), this.translate.currentLang);\n          }\n\n          if (remoteResource) {\n            if (this.resource['@id']) {\n              this.resource.combine(remoteResource);\n            } else {\n              this.resource = remoteResource;\n            }\n          }\n\n          if (!this.resource['@id']) {\n            this.onNoData();\n          }\n\n          this.loading = false;\n        },\n        error: error => console.log(error)\n      });\n    }\n\n    onNoData() {\n      if (this.datasetId === 'default') {\n        this.router.navigate(['/overview']);\n      } else {\n        this.router.navigate(['/datasets', this.datasetId]);\n      }\n    }\n\n    setPageJsonLd(resource) {\n      this.removePageJsonLd();\n      const script = this.document.createElement('script');\n      script.type = 'application/ld+json';\n      script.text = resource.asSchemaOrgJsonLd();\n      this.document.head.appendChild(script);\n    }\n\n    removePageJsonLd() {\n      this.document.querySelectorAll('[type=\"application/ld+json\"]').forEach(element => this.document.head.removeChild(element));\n    }\n\n    ngOnDestroy() {\n      this.removePageJsonLd();\n    }\n\n  }\n\n  ResourceComponent.ɵfac = function ResourceComponent_Factory(t) {\n    return new (t || ResourceComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.DatasetService), i0.ɵɵdirectiveInject(i3.TranslateService), i0.ɵɵdirectiveInject(DOCUMENT));\n  };\n\n  ResourceComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ResourceComponent,\n    selectors: [[\"app-resource\"]],\n    decls: 8,\n    vars: 11,\n    consts: [[\"id\", \"describe\", 1, \"row\"], [\"class\", \"col-12 m-0\", 4, \"ngIf\"], [\"id\", \"metadata\", 3, \"ngClass\", 4, \"ngIf\"], [\"id\", \"incoming\", \"class\", \"col-md-3 order-md-12 m-0 small\", 4, \"ngIf\"], [\"id\", \"localcontent\", \"class\", \"col-md-6 m-0\", 3, \"ngClass\", 4, \"ngIf\"], [\"id\", \"edit\", 1, \"row\"], [1, \"col-12\", \"text-right\"], [1, \"resource-btn\", \"fa\", \"fa-pencil-square-o\", 3, \"routerLink\", \"queryParams\", \"state\"], [1, \"col-12\", \"m-0\"], [1, \"badge\", \"badge-warning\", \"badge-pill\"], [\"id\", \"metadata\", 3, \"ngClass\"], [3, \"datasetId\", \"description\", \"details\", \"anonDescriptions\", \"resource\"], [\"id\", \"incoming\", 1, \"col-md-3\", \"order-md-12\", \"m-0\", \"small\"], [1, \"p-1\"], [1, \"d-block\", \"d-md-none\", \"d-lg-none\", \"d-xl-none\", \"float-right\"], [3, \"click\", 4, \"ngIf\"], [3, \"ngClass\"], [3, \"dataset\", \"facet\", \"resource\", 4, \"ngFor\", \"ngForOf\"], [3, \"click\"], [1, \"fa\", \"fa-plus-circle\"], [1, \"fa\", \"fa-minus-circle\"], [3, \"dataset\", \"facet\", \"resource\"], [\"id\", \"localcontent\", 1, \"col-md-6\", \"m-0\", 3, \"ngClass\"], [3, \"innerHTML\", 4, \"ngIf\"], [3, \"innerHTML\"]],\n    template: function ResourceComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵtemplate(1, ResourceComponent_div_1_Template, 3, 0, \"div\", 1);\n        i0.ɵɵtemplate(2, ResourceComponent_div_2_Template, 2, 11, \"div\", 2);\n        i0.ɵɵtemplate(3, ResourceComponent_div_3_Template, 11, 11, \"div\", 3);\n        i0.ɵɵtemplate(4, ResourceComponent_div_4_Template, 3, 6, \"div\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"div\", 5);\n        i0.ɵɵelementStart(6, \"div\", 6);\n        i0.ɵɵelement(7, \"i\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.loading);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.resource && ctx.resource[\"@id\"]);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.incomings && ctx.incomings.length);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.loading && (ctx.resource.anonBody || ctx.content));\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"routerLink\", \"../edit-resource\")(\"queryParams\", i0.ɵɵpureFunction1(7, _c3, ctx.resourceUri))(\"state\", i0.ɵɵpureFunction1(9, _c4, ctx.resource));\n      }\n    },\n    directives: [i4.NgIf, i4.NgClass, i5.DescriptionComponent, i4.NgForOf, i6.DetailIncomingFacetComponent, i1.RouterLink],\n    pipes: [i3.TranslatePipe],\n    styles: [\".resource-btn[_ngcontent-%COMP%]{cursor:pointer;margin-left:.5em}\"]\n  });\n  return ResourceComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}